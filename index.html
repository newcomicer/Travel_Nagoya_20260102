<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—é™¸åèŠ±ä¹‹é‡Œä¹‹æ—… 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'nook-bg': '#F7F4EB',
                        'nook-green': '#88AB8E',
                        'nook-dark': '#6B5B45',
                        'nook-card': '#FFFFFF',
                        'nook-accent': '#E76F51',
                    },
                    boxShadow: {
                        'soft': '4px 4px 0px #E0E5D5',
                        'soft-hover': '2px 2px 0px #E0E5D5',
                    },
                    fontFamily: {
                        'rounded': ['"M PLUS Rounded 1c"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #F7F4EB;
            background-image: radial-gradient(#E0E5D5 2px, transparent 2px);
            background-size: 20px 20px;
            color: #6B5B45;
            -webkit-tap-highlight-color: transparent;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .btn-press:active { transform: scale(0.95); box-shadow: 2px 2px 0px #E0E5D5 !important; transform: translate(2px, 2px); }
        .btn-disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        .tab-content { display: none; animation: fadeIn 0.3s ease-in-out; }
        .tab-content.active { display: block; }

        .sortable-ghost { opacity: 0.4; background: #f0f0f0; border: 2px dashed #ccc; }
        .sortable-drag { cursor: grabbing; opacity: 1; background: white; transform: rotate(2deg); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .edit-input { width: 100%; border-bottom: 1px dashed #88AB8E; background: transparent; outline: none; padding: 2px 0; color: #6B5B45; }
        .edit-input:focus { border-bottom: 2px solid #88AB8E; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .nav-item.active i { color: #88AB8E; transform: scale(1.1); }
        .nav-item.active span { color: #88AB8E; font-weight: bold; }
        
        /* Loading Spinner */
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #88AB8E; border-radius: 50%; width: 12px; height: 12px; animation: spin 1s linear infinite; display: inline-block; margin-right: 5px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="pb-24">

    <header class="sticky top-0 z-40 bg-[#F7F4EB]/95 backdrop-blur-sm px-4 py-3 border-b border-[#E0E5D5] shadow-sm">
        <div class="flex justify-between items-center">
            <h1 class="text-lg font-bold text-nook-green tracking-wide truncate">
                <i class="fa-solid fa-plane-departure mr-2"></i>åŒ—é™¸åèŠ±ä¹‹é‡Œ
            </h1>
            <div class="flex items-center gap-2">
                <button onclick="loadFromCloud()" id="load-btn" class="bg-white px-2 py-1.5 rounded-full shadow-soft border border-[#E0E5D5] text-purple-500 font-bold active:scale-95 transition cursor-pointer flex items-center justify-center min-w-[35px]" title="è®€å–é›²ç«¯å­˜æª”">
                    <i class="fa-solid fa-download text-sm"></i>
                </button>
                <button onclick="syncToCloud()" id="sync-btn" class="bg-white px-2 py-1.5 rounded-full shadow-soft border border-[#E0E5D5] text-blue-500 font-bold active:scale-95 transition cursor-pointer flex items-center justify-center min-w-[35px]" title="ä¸Šå‚³è‡³é›²ç«¯">
                    <i class="fa-solid fa-cloud-arrow-up text-sm"></i>
                </button>
                <button onclick="toggleEditMode()" id="edit-btn" class="bg-white px-3 py-1.5 rounded-full shadow-soft border border-[#E0E5D5] text-gray-600 font-bold active:scale-95 transition cursor-pointer text-xs flex items-center min-w-[60px] justify-center">
                    <i class="fa-solid fa-pen mr-1"></i>ç·¨è¼¯
                </button>
            </div>
        </div>
    </header>

    <main id="app" class="px-4 py-4 max-w-md mx-auto">
        
        <section id="view-plan" class="tab-content active">
            <div class="flex justify-between items-center mb-3 px-1">
                <div class="text-xs text-gray-500 bg-white px-3 py-1.5 rounded-full border border-gray-200 shadow-sm">
                    <span class="font-bold text-nook-green">å°éŠ:</span> æ—ä¸–è±ª 
                    <a href="tel:0912576813" class="ml-1 text-blue-500 underline">0912-576-813</a>
                </div>
                <div id="clock" class="text-xs font-mono text-nook-dark font-bold">00:00</div>
            </div>

            <div id="header-cards"></div>
            <div class="flex overflow-x-auto no-scrollbar gap-2 mb-4 pb-1 mt-6" id="day-tabs"></div>
            <div id="itinerary-container" class="min-h-[300px]"></div>
            
            <div id="add-activity-btn" class="hidden mt-4 text-center">
                <button onclick="addNewActivity()" class="bg-nook-green text-white px-4 py-2 rounded-xl shadow-soft btn-press text-sm font-bold w-full">
                    <i class="fa-solid fa-plus mr-2"></i>æ–°å¢è¡Œç¨‹é …ç›®
                </button>
            </div>
        </section>

        <section id="view-guide" class="tab-content">
             <div class="bg-white rounded-2xl p-5 border border-[#E0E5D5] shadow-soft mb-4">
                <h2 class="font-bold mb-3 text-nook-green">æ™¯é»åœ°åœ–å¿«é€ŸæŸ¥</h2>
                <div class="grid grid-cols-2 gap-3">
                    <a href="https://www.google.com/maps/search/?api=1&query=...0" target="_blank" class="bg-gray-50 p-3 rounded-xl text-center text-sm text-gray-700 hover:bg-gray-100"><i class="fa-solid fa-map-location-dot text-red-400 block mb-1 text-xl"></i>åˆæŒæ‘</a>
                    <a href="https://www.google.com/maps/search/?api=1&query=...0" target="_blank" class="bg-gray-50 p-3 rounded-xl text-center text-sm text-gray-700 hover:bg-gray-100"><i class="fa-brands fa-envira text-green-600 block mb-1 text-xl"></i>å…¼å…­åœ’</a>
                    <a href="https://www.google.com/maps/search/?api=1&query=...1" target="_blank" class="bg-gray-50 p-3 rounded-xl text-center text-sm text-gray-700 hover:bg-gray-100"><i class="fa-solid fa-cable-car text-blue-400 block mb-1 text-xl"></i>æ–°ç©—é«˜</a>
                    <a href="https://www.google.com/maps/search/?api=1&query=...2" target="_blank" class="bg-gray-50 p-3 rounded-xl text-center text-sm text-gray-700 hover:bg-gray-100"><i class="fa-solid fa-lightbulb text-yellow-400 block mb-1 text-xl"></i>åèŠ±ä¹‹é‡Œ</a>
                </div>
            </div>
        </section>

        <section id="view-wallet" class="tab-content">
             <div class="bg-nook-green p-5 rounded-2xl shadow-soft text-white mb-6">
                <div class="flex justify-between items-end mb-2">
                    <label class="text-xs opacity-80">æ—¥å¹£åŒ¯ç‡ (å¯ä¿®æ”¹)</label>
                    <div class="flex items-center">
                        <span class="text-xs mr-1">x</span>
                        <input type="number" id="exchange-rate" value="0.22" step="0.001" class="w-16 text-right text-nook-dark rounded px-1 py-0.5 text-sm font-bold bg-white" onchange="saveRate()">
                    </div>
                </div>
                <div class="bg-white/20 rounded-xl p-3 mb-3">
                    <input type="text" id="calc-input" placeholder="è¼¸å…¥ç®—å¼ (å¦‚ 500+200*3)" class="w-full bg-transparent text-right text-white text-xl font-mono placeholder-white/50 outline-none">
                </div>
                <div class="flex justify-between items-center">
                    <div class="text-3xl font-bold font-mono">â‰ˆ <span id="calc-result-twd">0</span> <span class="text-sm">TWD</span></div>
                    <button onclick="calculate()" class="bg-white text-nook-green px-4 py-2 rounded-lg font-bold shadow-sm btn-press">è¨ˆç®—</button>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 border border-[#E0E5D5] shadow-soft mb-6 transition-all duration-300" id="expense-form-card">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-gray-700 text-lg" id="expense-form-title">è¨˜ä¸€ç­†</h3>
                    <button id="cancel-edit-btn" onclick="cancelEdit()" class="hidden text-xs text-gray-400 underline">å–æ¶ˆç·¨è¼¯</button>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <input type="text" id="expense-item" placeholder="å“é … (å¦‚: æ‹‰éºµ)" class="border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-nook-green bg-gray-50">
                    <input type="number" id="expense-jpy" placeholder="æ—¥å¹£é‡‘é¡" class="border border-gray-200 rounded-lg p-3 text-sm outline-none focus:border-nook-green bg-gray-50">
                </div>
                <div class="flex gap-3">
                    <label class="flex-1 flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg text-gray-400 cursor-pointer hover:bg-gray-50 h-12 transition relative">
                        <i class="fa-solid fa-camera mr-2"></i>
                        <span id="photo-label" class="text-xs">æ‹ç…§/ä¸Šå‚³</span>
                        <input type="file" id="expense-photo" accept="image/*" class="hidden" onchange="handleWalletPhoto(this)">
                    </label>
                    <button id="save-expense-btn" onclick="addExpense()" class="flex-1 bg-nook-dark text-white rounded-lg font-bold shadow-soft btn-press h-12">å„²å­˜</button>
                </div>
            </div>

            <h3 class="font-bold ml-2 mb-2 text-gray-600 text-lg">æ¶ˆè²»ç´€éŒ„</h3>
            <div id="expense-list" class="space-y-3 pb-10"></div>
            <button onclick="clearExpenses()" class="w-full mt-4 text-xs text-gray-400 underline text-center block pb-4">æ¸…é™¤æ‰€æœ‰è¨˜å¸³è³‡æ–™</button>
        </section>

        <section id="view-lists" class="tab-content">
             <div class="bg-white rounded-2xl p-5 border border-[#E0E5D5] shadow-soft mb-6">
                <h3 class="font-bold mb-3 text-nook-green"><i class="fa-solid fa-clipboard-check mr-2"></i>è¡Œå‰æº–å‚™</h3>
                <div id="checklist-container" class="space-y-2"></div>
            </div>
        </section>

        <section id="view-info" class="tab-content">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="bg-blue-50 p-4 rounded-2xl border border-blue-100 shadow-sm flex flex-col items-center justify-center text-center btn-press">
                    <i class="fa-solid fa-cloud-sun text-3xl text-blue-400 mb-2"></i><span class="font-bold text-gray-700">å¤©æ°£é å ±</span>
                </a>
                <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="bg-purple-50 p-4 rounded-2xl border border-purple-100 shadow-sm flex flex-col items-center justify-center text-center btn-press">
                    <i class="fa-solid fa-qrcode text-3xl text-purple-500 mb-2"></i><span class="font-bold text-gray-700">Visit Japan</span>
                </a>
            </div>
        </section>

    </main>

    <div id="image-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4" onclick="closeImageModal()">
        <button class="absolute top-4 right-4 text-white text-2xl p-2"><i class="fa-solid fa-xmark"></i></button>
        <img id="modal-img" src="" class="max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain">
    </div>

    <nav class="fixed bottom-0 left-0 w-full bg-white/95 backdrop-blur border-t border-[#E0E5D5] pb-safe pt-2 px-2 z-50">
        <div class="flex justify-around items-center max-w-md mx-auto">
            <button onclick="switchTab('view-plan')" class="nav-item active flex flex-col items-center p-2 w-16 transition-all duration-300">
                <i class="fa-solid fa-calendar-days text-xl text-gray-400 mb-1"></i><span class="text-[10px] text-gray-400">è¡Œç¨‹</span>
            </button>
            <button onclick="switchTab('view-guide')" class="nav-item flex flex-col items-center p-2 w-16 transition-all duration-300">
                <i class="fa-solid fa-book-open text-xl text-gray-400 mb-1"></i><span class="text-[10px] text-gray-400">å°è¦½</span>
            </button>
            <button onclick="switchTab('view-wallet')" class="nav-item flex flex-col items-center p-2 w-16 transition-all duration-300">
                <div class="bg-nook-green rounded-full w-12 h-12 flex items-center justify-center -mt-6 border-4 border-[#F7F4EB] shadow-md">
                    <i class="fa-solid fa-wallet text-xl text-white"></i>
                </div>
            </button>
            <button onclick="switchTab('view-lists')" class="nav-item flex flex-col items-center p-2 w-16 transition-all duration-300">
                <i class="fa-solid fa-list-check text-xl text-gray-400 mb-1"></i><span class="text-[10px] text-gray-400">æ¸…å–®</span>
            </button>
            <button onclick="switchTab('view-info')" class="nav-item flex flex-col items-center p-2 w-16 transition-all duration-300">
                <i class="fa-solid fa-circle-info text-xl text-gray-400 mb-1"></i><span class="text-[10px] text-gray-400">è³‡è¨Š</span>
            </button>
        </div>
        <div class="h-4 w-full"></div> 
    </nav>

    <script>
        // ==========================================
        // --- è¨­å®šå€ (è«‹å¡«å…¥ Google Script URL) ---
        // ==========================================
        const GAS_API_URL = "https://script.google.com/macros/s/AKfycbw2dL2WyiTVZ9W2E46PUCuAyF0IuCL0LGpc8OdF4VwxVgJqKtlb1o9Yc_4Ydz9gOyalVg/exec";

        // ==========================================
        // --- è³‡æ–™æ ¸å¿ƒ ---
        // ==========================================
        
        const DEFAULT_DATA = {
            checklist: ["è­·ç…§", "ç¶²å¡", "è¡Œå‹•é›»æº(éš¨èº«)", "æ—¥å¹£", "å¸¸å‚™è—¥", "ç‰™åˆ·ç‰™è†"],
            rate: 0.22,
            expenses: [], 
            days: [
              {
                id: "d1", day: "D1", date: "01/02 (äº”)", location: "æ„›çŸ¥ç¸£",
                activities: [
                  { id: "a1-1", time: "06:30", title: "æ¡ƒæ©Ÿä¸€èˆªå»ˆæ³°ç…æ«ƒå°é›†åˆ", type: "transport", city: "æ¡ƒåœ’", desc: "æ‰¾å°éŠ: æ—ä¸–è±ªï¼Œæ³°ç…èˆªç©º 2è™Ÿæ«ƒå°" },
                  { id: "a1-2", time: "09:00", title: "æ­ä¹˜æ³°ç…èˆªç©º SL398", type: "transport", city: "æ¡ƒåœ’", desc: "é£›å¾€åå¤å±‹" },
                  { id: "a1-3", time: "12:40", title: "æŠµé”ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "transport", city: "å¸¸æ»‘", desc: "å‡ºé—œé ˜è¡Œæ" },
                  { id: "a1-4", time: "15:00", title: "åå¤å±‹å¸‚å€ / é£¯åº— Check-in", type: "stay", city: "åå¤å±‹", desc: "ä½å®¿: åå¤å±‹å¸Œçˆ¾é “é…’åº—" }
                ]
              },
              {
                id: "d2", day: "D2", date: "01/03 (å…­)", location: "å²é˜œç¸£",
                activities: [
                  { id: "a2-1", time: "09:00", title: "æƒ é‚£å³½å±•æœ›å°", type: "spot", city: "æƒ é‚£", desc: "å¤§è‡ªç„¶ä¾µè•è€Œå½¢æˆçš„æ–·å´–çµ•å£ï¼Œå¥‡å²©æ€ªçŸ³" },
                  { id: "a2-2", time: "12:00", title: "é¦¬ç± å®¿æˆ–å¦»ç± å®¿", type: "spot", city: "ä¸­æ´¥å·", desc: "å¾·å·å¾¡å®¿å¤è¡—æ•£ç­–ï¼Œæ±Ÿæˆ¶æ™‚ä»£å®¿é©›é¢¨æƒ…" },
                  { id: "a2-3", time: "17:00", title: "å…¥ä½æº«æ³‰é£¯åº—", type: "stay", city: "å¾¡å²³", desc: "ä½å®¿: å¾¡å²³ Golf & Resort (äº«å—æº«æ³‰èˆ‡æœƒå¸­æ–™ç†)" }
                ]
              },
              {
                id: "d3", day: "D3", date: "01/04 (æ—¥)", location: "å²é˜œç¸£",
                activities: [
                  { id: "a3-1", time: "09:00", title: "æ–°ç©—é«˜é›™å±¤ç©ºä¸­çºœè»Š", type: "spot", city: "é«˜å±±", highlight: true, desc: "æ—¥æœ¬æœ€æ—©é›™å±¤çºœè»Šï¼Œçœºæœ›é˜¿çˆ¾å‘æ–¯å±±é›ªæ™¯ (æ–°ç©—é«˜æº«æ³‰-è¥¿ç©‚é«˜å£)" },
                  { id: "a3-2", time: "13:00", title: "é£›é©’é«˜å±±å°äº¬éƒ½", type: "spot", city: "é«˜å±±", desc: "ç±³å…¶æ—ä¸‰æ˜Ÿæ™¯é»ï¼šå¤ä¹‹ç”ºä¸¦ãƒ»ä¸Šä¸‰ä¹‹ç”ºæ•£ç­–" },
                  { id: "a3-3", time: "17:00", title: "å…¥ä½é£›é©’é«˜å±±æº«æ³‰", type: "stay", city: "é«˜å±±", desc: "ä½å®¿: Route INN Grantia é£›é©’é«˜å±±" }
                ]
              },
              {
                id: "d4", day: "D4", date: "01/05 (ä¸€)", location: "åŒ—é™¸",
                activities: [
                  { id: "a4-1", time: "09:00", title: "åº„å·å³½éŠèˆ¹", type: "spot", city: "å¯Œå±±", desc: "åŒ—é™¸çµ•æ™¯ï¼Œæ­èˆ¹æ¬£è³å¹½ç„¶æ·±é‚çš„æºªè°·èˆ‡é›ªæ™¯" },
                  { id: "a4-2", time: "12:00", title: "è¿‘æ±Ÿç”ºå¸‚å ´", type: "food", city: "é‡‘æ¾¤", desc: "é‡‘æ¾¤å»šæˆ¿ï¼Œæµ·é®®å·¡ç¦® (åˆé¤è‡ªç†)" },
                  { id: "a4-3", time: "14:00", title: "å…¼å…­åœ’ & å‚˜æ¾é›ªåŠ", type: "spot", city: "é‡‘æ¾¤", highlight: true, desc: "æ—¥æœ¬ä¸‰å¤§ååœ’ä¹‹ä¸€ï¼Œå†¬å­£é™å®šé›ªåŠç¾æ™¯" },
                  { id: "a4-4", time: "16:00", title: "æ±èŒ¶å±‹è¡—", type: "spot", city: "é‡‘æ¾¤", desc: "åœ‹å®¶æŒ‡å®šæ–‡åŒ–è²¡ï¼Œæ±Ÿæˆ¶æ™‚ä»£èŒ¶å±‹è¡—é¢¨æƒ…" },
                  { id: "a4-5", time: "18:00", title: "å…¥ä½é‡‘æ¾¤é£¯åº—", type: "stay", city: "é‡‘æ¾¤", desc: "ä½å®¿: é‡‘æ¾¤ T-MARK HOTEL" }
                ]
              },
              {
                id: "d5", day: "D5", date: "01/06 (äºŒ)", location: "å²é˜œ/ä¸‰é‡",
                activities: [
                  { id: "a5-1", time: "09:00", title: "ç™½å·é„‰è»ç”ºåˆæŒæ‘", type: "spot", city: "ç™½å·é„‰", highlight: true, desc: "ä¸–ç•Œæ–‡åŒ–éºç”¢ï¼Œå†¬å­£å®›å¦‚ç«¥è©±è–‘é¤…å±‹èˆ¬é›ªæ™¯" },
                  { id: "a5-2", time: "13:00", title: "å…ç¨…åº—", type: "shopping", city: "åå¤å±‹", desc: "è³¼ç‰©è¡Œç¨‹" },
                  { id: "a5-3", time: "14:30", title: "ä¸‰äº• OUTLET çˆµå£«ä¹‹å¤¢é•·å³¶", type: "shopping", city: "æ¡‘å", desc: "æ—¥æœ¬æœ€å¤§ Outlet é›†åœ˜ï¼Œç˜‹ç‹‚è¡€æ‹¼" },
                  { id: "a5-4", time: "17:30", title: "åèŠ±ä¹‹é‡Œå¤¢å¹»é»ç‡ˆ", type: "spot", city: "æ¡‘å", highlight: true, desc: "æ—¥æœ¬æœ€å¤§è¦æ¨¡ LED å½©ç‡ˆæ…¶å…¸ (å…‰ä¹‹è¿´å»Š)" },
                  { id: "a5-5", time: "20:00", title: "å…¥ä½åå¤å±‹é£¯åº—", type: "stay", city: "åå¤å±‹", desc: "ä½å®¿: åå¤å±‹ Centmain é£¯åº—" }
                ]
              },
              {
                id: "d6", day: "D6", date: "01/07 (ä¸‰)", location: "æ„›çŸ¥ç¸£",
                activities: [
                  { id: "a6-1", time: "09:00", title: "è‡ªç”±æ´»å‹•", type: "spot", city: "åå¤å±‹", desc: "æœ€å¾Œè£œè²¨æˆ–ä¼‘æ¯" },
                  { id: "a6-2", time: "11:30", title: "å‰å¾€ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "transport", city: "å¸¸æ»‘", desc: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ" },
                  { id: "a6-3", time: "13:40", title: "æ­ä¹˜æ³°ç…èˆªç©º SL399", type: "transport", city: "å¸¸æ»‘", desc: "é£›å¾€æ¡ƒåœ’" },
                  { id: "a6-4", time: "16:00", title: "æŠµé”æ¡ƒåœ’æ©Ÿå ´", type: "transport", city: "æ¡ƒåœ’", desc: "æº«æš–çš„å®¶" }
                ]
              }
            ]
        };

        let appData = {};
        let currentDayIndex = 0;
        let isEditMode = false;
        let sortableInstance = null;
        let tempWalletPhoto = null;
        let editingExpenseId = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderHeaderInfo();
            renderDayTabs();
            renderItinerary();
            loadChecklist();
            loadExpenses();
            document.getElementById('exchange-rate').value = appData.rate || 0.22;
            updateClock();
            setInterval(updateClock, 1000);
        });

        // --- é›²ç«¯åŒæ­¥ (ä¸Šå‚³) ---
        function syncToCloud() {
            if (GAS_API_URL.includes("è«‹åœ¨æ­¤å¡«å…¥")) {
                alert("è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š Google Script URLï¼");
                return;
            }
            const btn = document.getElementById('sync-btn');
            const icon = btn.innerHTML;
            btn.innerHTML = '<span class="spinner"></span>';
            
            let cleanData = JSON.parse(JSON.stringify(appData));
            // ç‚ºäº†ä¸è®“ Base64 åœ–ç‰‡å¡çˆ†è©¦ç®—è¡¨ï¼Œè¤‡è£½ä¸€ä»½ä¸¦ç§»é™¤åœ–ç‰‡å­—ä¸²
            cleanData.days.forEach(day => {
                day.activities.forEach(act => delete act.image);
            });
            cleanData.expenses.forEach(ex => delete ex.photo);

            fetch(GAS_API_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'save_all', appData: cleanData })
            })
            .then(res => res.json())
            .then(data => {
                alert("âœ… ä¸Šå‚³æˆåŠŸï¼ä»–äººå¯æŒ‰ã€Œè®€å–ã€æŒ‰éˆ•åŒæ­¥ã€‚");
                btn.innerHTML = icon;
            })
            .catch(err => {
                alert("âŒ ä¸Šå‚³å¤±æ•—ï¼š" + err);
                btn.innerHTML = icon;
            });
        }

        // --- é›²ç«¯è®€å– (ä¸‹è¼‰) ---
        function loadFromCloud() {
            if (GAS_API_URL.includes("è«‹åœ¨æ­¤å¡«å…¥")) {
                alert("è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®š Google Script URLï¼");
                return;
            }
            if(!confirm("ç¢ºå®šè¦å¾é›²ç«¯è®€å–ï¼Ÿé€™æœƒè¦†è“‹æ‚¨ç›®å‰çš„è¡Œç¨‹è®Šæ›´ã€‚")) return;

            const btn = document.getElementById('load-btn');
            const icon = btn.innerHTML;
            btn.innerHTML = '<span class="spinner"></span>';

            fetch(GAS_API_URL + '?action=get_all')
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success' && data.appData) {
                    appData = data.appData;
                    // è‹¥é›²ç«¯æ²’è¨˜å¸³è³‡æ–™ï¼Œä¿ç•™æœ¬åœ°çš„ï¼ˆé¿å…èª¤åˆªï¼‰
                    if (!appData.expenses) appData.expenses = [];
                    saveData();
                    renderItinerary();
                    renderDayTabs(); // é‡æ–°æ¸²æŸ“æ—¥æœŸæ¨™ç±¤
                    loadExpenses(); // é‡æ–°è¼‰å…¥è¨˜å¸³
                    alert("âœ… åŒæ­¥å®Œæˆï¼å·²è¼‰å…¥æœ€æ–°è¡Œç¨‹ã€‚");
                } else {
                    alert("âš ï¸ é›²ç«¯ä¼¼ä¹æ²’æœ‰è³‡æ–™ï¼Œæˆ–è®€å–å¤±æ•—ã€‚");
                }
                btn.innerHTML = icon;
            })
            .catch(err => {
                alert("âŒ è®€å–å¤±æ•—ï¼š" + err);
                btn.innerHTML = icon;
            });
        }

        // --- LocalStorage ---
        function loadData() {
            const saved = localStorage.getItem('travelApp_data_v11'); // ç‰ˆæœ¬ v11
            if (saved) {
                appData = JSON.parse(saved);
                if (!appData.expenses) appData.expenses = [];
                if (!appData.rate) appData.rate = 0.22;
            } else {
                appData = JSON.parse(JSON.stringify(DEFAULT_DATA));
                saveData();
            }
        }
        function saveData() { localStorage.setItem('travelApp_data_v11', JSON.stringify(appData)); }

        // --- Wallet Logic ---
        function saveRate() {
            appData.rate = document.getElementById('exchange-rate').value;
            saveData();
            loadExpenses();
        }
        function calculate() {
            const val = document.getElementById('calc-input').value;
            try {
                const res = Math.round(eval(val.replace(/x/gi, '*')) * appData.rate);
                document.getElementById('calc-result-twd').innerText = res;
            } catch(e) { alert('ç®—å¼éŒ¯èª¤'); }
        }
        function handleWalletPhoto(input) {
             if (input.files && input.files[0]) {
                const label = document.getElementById('photo-label');
                const btn = document.getElementById('save-expense-btn');
                label.innerText = "è™•ç†ä¸­...";
                btn.innerText = "è™•ç†ä¸­...";
                btn.disabled = true;
                btn.classList.add('btn-disabled');

                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const maxWidth = 800; 
                        const scaleSize = maxWidth / img.width;
                        canvas.width = maxWidth;
                        canvas.height = img.height * scaleSize;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        tempWalletPhoto = canvas.toDataURL('image/jpeg', 0.6);
                        
                        label.innerText = "å·²è®€å– (å¯å„²å­˜)";
                        label.classList.add('text-nook-green', 'font-bold');
                        btn.disabled = false;
                        btn.classList.remove('btn-disabled');
                        btn.innerText = editingExpenseId ? "æ›´æ–°" : "å„²å­˜";
                    }
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function addExpense() {
            const item = document.getElementById('expense-item').value;
            const jpy = document.getElementById('expense-jpy').value;
            if(!item || !jpy) { alert("è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡"); return; }
            
            const expenseData = {
                date: new Date().toLocaleDateString(),
                item: item,
                jpy: jpy,
                twd: Math.round(jpy * appData.rate),
                note: 'User Upload'
            };

            if (editingExpenseId) {
                const idx = appData.expenses.findIndex(e => e.id === editingExpenseId);
                if (idx !== -1) {
                    appData.expenses[idx].item = item;
                    appData.expenses[idx].jpy = parseInt(jpy);
                    if (tempWalletPhoto) appData.expenses[idx].photo = tempWalletPhoto;
                }
                cancelEdit();
            } else {
                appData.expenses.unshift({
                    id: Date.now(),
                    item: item,
                    jpy: parseInt(jpy),
                    photo: tempWalletPhoto,
                    date: expenseData.date
                });
                
                if (!GAS_API_URL.includes("è«‹åœ¨æ­¤å¡«å…¥")) {
                    fetch(GAS_API_URL, {
                        method: 'POST',
                        body: JSON.stringify({ action: 'add_expense', ...expenseData })
                    }).catch(e => console.log("Sync Error", e));
                }

                document.getElementById('expense-item').value = '';
                document.getElementById('expense-jpy').value = '';
                resetPhotoUI();
            }
            document.getElementById('expense-photo').value = '';
            saveData();
            loadExpenses();
        }
        function editExpense(id) {
            const exp = appData.expenses.find(e => e.id === id);
            if (!exp) return;
            editingExpenseId = id;
            document.getElementById('expense-item').value = exp.item;
            document.getElementById('expense-jpy').value = exp.jpy;
            document.getElementById('expense-form-title').innerText = "ç·¨è¼¯æ¶ˆè²»";
            const btn = document.getElementById('save-expense-btn');
            btn.innerText = "æ›´æ–°";
            btn.classList.replace('bg-nook-dark', 'bg-nook-accent');
            document.getElementById('cancel-edit-btn').classList.remove('hidden');
            document.getElementById('expense-form-card').scrollIntoView({behavior: "smooth"});
            const label = document.getElementById('photo-label');
            label.innerText = "æ›´æ›ç…§ç‰‡(é¸å¡«)";
            label.classList.remove('text-nook-green', 'font-bold');
            tempWalletPhoto = null;
        }
        function cancelEdit() {
            editingExpenseId = null;
            document.getElementById('expense-item').value = '';
            document.getElementById('expense-jpy').value = '';
            document.getElementById('expense-form-title').innerText = "è¨˜ä¸€ç­†";
            const btn = document.getElementById('save-expense-btn');
            btn.innerText = "å„²å­˜";
            btn.classList.replace('bg-nook-accent', 'bg-nook-dark');
            btn.disabled = false;
            btn.classList.remove('btn-disabled');
            document.getElementById('cancel-edit-btn').classList.add('hidden');
            resetPhotoUI();
        }
        function resetPhotoUI() {
            const label = document.getElementById('photo-label');
            label.innerText = "æ‹ç…§/ä¸Šå‚³";
            label.classList.remove('text-nook-green', 'font-bold');
            tempWalletPhoto = null;
        }
        function deleteExpense(id) {
            if(confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
                appData.expenses = appData.expenses.filter(e => e.id !== id);
                saveData();
                loadExpenses();
            }
        }
        function loadExpenses() {
            const list = document.getElementById('expense-list');
            if (appData.expenses.length === 0) { list.innerHTML = '<div class="text-center text-gray-400 text-sm py-4">ç„¡ç´€éŒ„</div>'; return; }
            let html = '';
            appData.expenses.forEach(ex => {
                const twd = Math.round(ex.jpy * appData.rate);
                const photoHtml = ex.photo ? `<img src="${ex.photo}" onclick="showImageModal('${ex.photo}')" class="w-12 h-12 rounded-lg object-cover border border-gray-200 mr-3 cursor-pointer">` : '<div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center mr-3 text-gray-300"><i class="fa-solid fa-receipt"></i></div>';
                html += `<div class="bg-white p-3 rounded-xl flex items-center shadow-sm border border-gray-100 mb-2">
                    ${photoHtml}
                    <div class="flex-1 min-w-0 mr-2"><div class="font-bold text-gray-700 truncate">${ex.item}</div><div class="text-xs text-gray-400">${ex.date}</div></div>
                    <div class="text-right mr-3"><div class="font-bold text-nook-dark">Â¥${ex.jpy}</div><div class="text-xs text-gray-400">â‰ˆ $${twd}</div></div>
                    <div class="flex flex-col gap-2 pl-2 border-l border-gray-100">
                        <button onclick="editExpense(${ex.id})" class="text-gray-400 hover:text-nook-green"><i class="fa-solid fa-pen-to-square"></i></button>
                        <button onclick="deleteExpense(${ex.id})" class="text-gray-400 hover:text-red-400"><i class="fa-solid fa-trash-can"></i></button>
                    </div></div>`;
            });
            list.innerHTML = html;
        }
        function clearExpenses() { if(confirm("åˆªé™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ")) { appData.expenses = []; saveData(); loadExpenses(); } }

        // --- Render Helpers ---
        function renderHeaderInfo() {
            const container = document.getElementById('header-cards');
            container.innerHTML = `
            <div class="bg-[#FFF0F0] rounded-2xl p-5 mb-4 shadow-sm border border-[#FFE0E0]">
                <div class="flex items-center gap-2 mb-2 text-[#D65A5A] font-bold text-lg"><i class="fa-solid fa-bell"></i> é›†åˆè³‡è¨Š</div>
                <div class="flex items-baseline gap-3 mb-1"><span class="text-3xl font-bold text-gray-800">06:30</span><span class="text-gray-600 font-bold">æ¡ƒæ©Ÿä¸€èˆªå»ˆ</span></div>
                <div class="flex justify-between items-end"><div class="text-sm text-gray-500">æ³°ç…èˆªç©º 2è™Ÿæ«ƒå°</div><a href="https://www.google.com/maps/search/?api=1&query=æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ" target="_blank" class="bg-white text-[#D65A5A] px-4 py-1.5 rounded-lg text-sm shadow-sm border border-[#FADEDE] font-bold btn-press"><i class="fa-solid fa-location-dot mr-1"></i> å°èˆª</a></div>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-4">
                <h3 class="text-[#B59868] font-bold text-lg mb-6 flex items-center"><i class="fa-solid fa-plane mr-2 transform -rotate-45"></i> èˆªç­ (æ³°ç…)</h3>
                <div class="flex justify-between items-center mb-6">
                    <div class="text-center w-1/4"><div class="text-3xl font-bold text-gray-800">TPE</div><div class="text-gray-400 text-sm">09:00</div></div>
                    <div class="flex-1 px-2 text-center relative"><div class="text-xs text-gray-400 font-bold mb-1">SL398</div><div class="relative flex items-center justify-center py-2"><div class="h-[2px] bg-gray-200 w-full absolute border-b border-dashed border-gray-300"></div><i class="fa-solid fa-plane text-[#B59868] bg-white px-2 relative z-10 text-sm"></i></div><div class="text-xs text-gray-400">1/2 (äº”)</div></div>
                    <div class="text-center w-1/4"><div class="text-3xl font-bold text-gray-800">NGO</div><div class="text-gray-400 text-sm">12:40</div></div>
                </div>
                <div class="border-b border-gray-100 my-4"></div>
                <div class="flex justify-between items-center">
                    <div class="text-center w-1/4"><div class="text-3xl font-bold text-gray-800">NGO</div><div class="text-gray-400 text-sm">13:40</div></div>
                    <div class="flex-1 px-2 text-center relative"><div class="text-xs text-gray-400 font-bold mb-1">SL399</div><div class="relative flex items-center justify-center py-2"><div class="h-[2px] bg-gray-200 w-full absolute border-b border-dashed border-gray-300"></div><i class="fa-solid fa-plane text-[#B59868] bg-white px-2 relative z-10 text-sm transform rotate-180"></i></div><div class="text-xs text-gray-400">1/7 (ä¸‰)</div></div>
                    <div class="text-center w-1/4"><div class="text-3xl font-bold text-gray-800">TPE</div><div class="text-gray-400 text-sm">16:00</div></div>
                </div>
            </div>`;
        }
        function renderDayTabs() {
            const container = document.getElementById('day-tabs');
            let html = '';
            appData.days.forEach((d, idx) => {
                const activeClass = idx === currentDayIndex ? 'bg-nook-green text-white shadow-md' : 'bg-white text-gray-500 border border-gray-200';
                html += `<button onclick="selectDay(${idx})" class="flex-shrink-0 px-4 py-2 rounded-xl transition-all ${activeClass}"><div class="text-xs font-bold">${d.day}</div><div class="text-[10px] opacity-80">${d.date.split(' ')[0]}</div></button>`;
            });
            container.innerHTML = html;
        }
        function selectDay(idx) { currentDayIndex = idx; renderDayTabs(); renderItinerary(); }
        function renderItinerary() {
            const container = document.getElementById('itinerary-container');
            const dayData = appData.days[currentDayIndex];
            let html = `<div class="text-center mb-4"><span class="bg-gray-200 text-gray-600 text-xs px-2 py-1 rounded-full"><i class="fa-solid fa-map-pin mr-1"></i>${dayData.location}</span></div><div id="sortable-list" class="space-y-4 pb-20">`;
            dayData.activities.forEach((act, idx) => {
                // å„ªå…ˆä½¿ç”¨è‡ªè¨‚é€£çµï¼Œå¦å‰‡ä½¿ç”¨è‡ªå‹•ç”Ÿæˆ
                const mapUrl = act.link ? act.link : `https://www.google.com/maps/search/?api=1&query=$${encodeURIComponent(act.city ? act.city + ' ' + act.title : act.title)}`;
                const isHighlight = act.highlight ? 'border-l-4 border-nook-accent bg-orange-50' : '';
                let imgHtml = act.image ? `<div class="mt-2 relative group"><img src="${act.image}" class="w-full h-32 object-cover rounded-lg shadow-sm">${isEditMode ? `<button onclick="removeImage('${dayData.id}', ${idx})" class="absolute top-1 right-1 bg-red-500 text-white w-6 h-6 rounded-full text-xs shadow-md"><i class="fa-solid fa-xmark"></i></button>` : ''}</div>` : (isEditMode ? `<div class="mt-2 border-2 border-dashed border-gray-300 rounded-lg p-2 text-center"><label class="cursor-pointer block"><i class="fa-solid fa-camera text-gray-400"></i><span class="text-xs text-gray-400 block">ä¸Šå‚³ç…§ç‰‡</span><input type="file" accept="image/*" class="hidden" onchange="uploadImage(this, '${dayData.id}', ${idx})"></label></div>` : '');
                
                if (isEditMode) {
                    html += `
                        <div class="bg-white rounded-xl p-3 border border-[#E0E5D5] shadow-sm relative pl-10" data-id="${idx}">
                            <div class="drag-handle absolute left-0 top-0 bottom-0 w-8 flex items-center justify-center cursor-move text-gray-300 hover:text-gray-500 bg-gray-50 rounded-l-xl border-r border-gray-100"><i class="fa-solid fa-grip-vertical"></i></div>
                            <button onclick="deleteActivity('${dayData.id}', ${idx})" class="absolute top-2 right-2 text-red-400 text-xs"><i class="fa-solid fa-trash"></i></button>
                            <div class="space-y-2">
                                <div class="flex gap-2">
                                    <input type="text" class="edit-input w-20 font-mono text-sm" value="${act.time}" onchange="updateActivity('${dayData.id}', ${idx}, 'time', this.value)" placeholder="æ™‚é–“">
                                    <input type="text" class="edit-input flex-1 font-bold text-gray-800" value="${act.title}" onchange="updateActivity('${dayData.id}', ${idx}, 'title', this.value)" placeholder="æ¨™é¡Œ">
                                </div>
                                <div class="flex gap-2">
                                    <input type="text" class="edit-input w-20 text-xs" value="${act.city || ''}" onchange="updateActivity('${dayData.id}', ${idx}, 'city', this.value)" placeholder="åœ°å€">
                                    <input type="text" class="edit-input flex-1 text-xs text-gray-500" value="${act.desc || ''}" onchange="updateActivity('${dayData.id}', ${idx}, 'desc', this.value)" placeholder="å‚™è¨»/æè¿°">
                                </div>
                                <div>
                                    <input type="text" class="edit-input text-xs text-blue-500 w-full" value="${act.link || ''}" onchange="updateActivity('${dayData.id}', ${idx}, 'link', this.value)" placeholder="ğŸ”— åœ°åœ–é€£çµ (é¸å¡«)">
                                </div>
                            </div>
                            ${imgHtml}
                        </div>
                    `;
                } else {
                    html += `<div class="relative pl-4" data-id="${idx}"><div class="absolute left-0 top-2 bottom-2 w-0.5 bg-gray-200"></div><div class="absolute left-[-4px] top-3 w-2.5 h-2.5 rounded-full bg-nook-green border-2 border-white shadow-sm"></div><div class="bg-white rounded-xl p-3 border border-[#E0E5D5] shadow-sm ${isHighlight} ml-2"><div class="flex justify-between items-start"><div class="flex items-center gap-2"><span class="font-mono text-nook-green font-bold text-sm bg-[#F7F4EB] px-2 rounded">${act.time}</span>${act.city ? `<span class="text-[10px] bg-gray-100 text-gray-500 px-1.5 rounded">${act.city}</span>` : ''}</div><a href="${mapUrl}" target="_blank" class="text-xs text-blue-500 hover:text-blue-700 flex items-center"><i class="fa-solid fa-location-dot mr-1"></i>åœ°åœ–</a></div><h4 class="font-bold text-gray-800 mt-1 text-base">${act.type === 'transport' ? '<i class="fa-solid fa-train-subway text-gray-400 mr-1"></i>' : '<i class="fa-solid fa-camera text-gray-400 mr-1"></i>'} ${act.title}</h4>${act.desc ? `<p class="text-sm text-gray-500 mt-1 leading-relaxed">${act.desc}</p>` : ''}${imgHtml}</div></div>`;
                }
            });
            html += `</div>`;
            container.innerHTML = html;
            if (isEditMode && Sortable) {
                if (sortableInstance) sortableInstance.destroy();
                sortableInstance = Sortable.create(document.getElementById('sortable-list'), { handle: '.drag-handle', animation: 150, onEnd: function (evt) { const day = appData.days[currentDayIndex]; const item = day.activities.splice(evt.oldIndex, 1)[0]; day.activities.splice(evt.newIndex, 0, item); saveData(); renderItinerary(); }});
            }
        }
        
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('edit-btn');
            const addBtn = document.getElementById('add-activity-btn');
            
            // ä¿®æ­£ï¼šåœ¨å®Œæˆæ™‚ï¼ŒæŒ‰éˆ•æ”¹ç‚ºç¶ åº•ç™½å­—ï¼›ç·¨è¼¯æ™‚ï¼ŒæŒ‰éˆ•ç‚ºç™½åº•ç°å­—
            if (isEditMode) {
                btn.innerHTML = '<i class="fa-solid fa-check mr-1"></i>å®Œæˆ';
                btn.className = "bg-nook-green text-white px-4 py-1.5 rounded-full shadow-soft border border-nook-green font-bold active:scale-95 transition cursor-pointer text-xs flex items-center min-w-[70px] justify-center";
                addBtn.classList.remove('hidden');
            } else {
                btn.innerHTML = '<i class="fa-solid fa-pen mr-1"></i>ç·¨è¼¯';
                btn.className = "bg-white text-gray-600 px-4 py-1.5 rounded-full shadow-soft border border-[#E0E5D5] font-bold active:scale-95 transition cursor-pointer text-xs flex items-center min-w-[70px] justify-center";
                addBtn.classList.add('hidden');
            }
            renderItinerary();
        }

        function updateActivity(dayId, idx, field, value) { const day = appData.days.find(d => d.id === dayId); if (day) { day.activities[idx][field] = value; saveData(); } }
        function addNewActivity() { const day = appData.days[currentDayIndex]; day.activities.push({ id: Date.now(), time: "00:00", title: "æ–°è¡Œç¨‹", type: "spot", desc: "", city: "" }); saveData(); renderItinerary(); }
        function deleteActivity(dayId, idx) { if(confirm('åˆªé™¤ï¼Ÿ')) { const day = appData.days.find(d => d.id === dayId); day.activities.splice(idx, 1); saveData(); renderItinerary(); } }
        function uploadImage(input, dayId, idx) { if (input.files && input.files[0]) { const reader = new FileReader(); reader.onload = function(e) { const img = new Image(); img.src = e.target.result; img.onload = function() { const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d'); const scale = 400 / img.width; canvas.width = 400; canvas.height = img.height * scale; ctx.drawImage(img, 0, 0, canvas.width, canvas.height); const day = appData.days.find(d => d.id === dayId); day.activities[idx].image = canvas.toDataURL('image/jpeg', 0.6); saveData(); renderItinerary(); } }; reader.readAsDataURL(input.files[0]); } }
        function removeImage(dayId, idx) { const day = appData.days.find(d => d.id === dayId); delete day.activities[idx].image; saveData(); renderItinerary(); }
        function loadChecklist() { const list = appData.checklist; const savedState = JSON.parse(localStorage.getItem('travelApp_check_state') || '{}'); let html = ''; list.forEach((item, i) => { const checked = savedState[i] ? 'checked' : ''; const style = savedState[i] ? 'line-through text-gray-400' : 'text-gray-700'; html += `<label class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer"><input type="checkbox" onchange="toggleCheck(${i}, this)" ${checked} class="w-5 h-5 text-nook-green rounded border-gray-300"><span id="chk-${i}" class="${style}">${item}</span></label>`; }); document.getElementById('checklist-container').innerHTML = html; }
        function toggleCheck(idx, cb) { const savedState = JSON.parse(localStorage.getItem('travelApp_check_state') || '{}'); savedState[idx] = cb.checked; localStorage.setItem('travelApp_check_state', JSON.stringify(savedState)); const el = document.getElementById(`chk-${idx}`); el.className = cb.checked ? 'line-through text-gray-400' : 'text-gray-700'; }
        function showImageModal(src) { document.getElementById('modal-img').src = src; document.getElementById('image-modal').classList.remove('hidden'); }
        function closeImageModal() { document.getElementById('image-modal').classList.add('hidden'); }
        function switchTab(tabId) { document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active')); document.getElementById(tabId).classList.add('active'); window.scrollTo(0,0); document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active')); const map = {'view-plan':0, 'view-guide':1, 'view-wallet':2, 'view-lists':3, 'view-info':4}; document.querySelectorAll('.nav-item')[map[tabId]].classList.add('active'); }
        function updateClock() { document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-US', {hour:'2-digit', minute:'2-digit', hour12:false}); }
    </script>
</body>
</html>
